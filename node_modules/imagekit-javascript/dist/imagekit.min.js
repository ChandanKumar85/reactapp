!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImageKit=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var a={message:"Missing urlEndpoint during SDK initialization",help:""},i={message:"Invalid transformationPosition parameter",help:""},s={message:"Missing file parameter for upload",help:""},u={message:"Missing fileName parameter for upload",help:""},p={message:"Missing public key for upload",help:""},l={message:"Request to ImageKit upload endpoint failed due to network error",help:""},f={message:"Invalid uploadOptions parameter",help:""},c={message:"Missing signature for upload. The SDK expects token, sginature and expire for authentication.",help:""},y={message:"Missing token for upload. The SDK expects token, sginature and expire for authentication.",help:""},d={message:"Missing expire for upload. The SDK expects token, sginature and expire for authentication.",help:""};function g(e,t,r){"function"==typeof r&&(e?r(t,null):r(null,t))}function h(e){var t={},r=e.getAllResponseHeaders();return Object.keys(r).length&&r.trim().split(/[\r\n]+/).map((function(e){return e.split(/: /)})).forEach((function(e){t[e[0].trim()]=e[1].trim()})),t}var m=function(e,t){var r=o({},e),n={statusCode:t.status,headers:h(t)};return Object.defineProperty(r,"$ResponseMetadata",{value:n,enumerable:!1,writable:!1}),r},v=function(e,t){return new Promise((function(r,n){e.open("POST","https://upload.imagekit.io/api/v1/files/upload"),e.onerror=function(e){return n(l)},e.onload=function(){if(200===e.status)try{var t=JSON.parse(e.responseText),o=m(t,e);return r(o)}catch(e){return n(e)}else try{t=JSON.parse(e.responseText);var a=m(t,e);return n(a)}catch(e){return n(e)}},e.send(t)}))},b=function(t,r,n,o){if(r.file)if(r.fileName)if(n.publicKey)if(r.token)if(r.signature)if(r.expire){var a,i=new FormData;for(a in r)a&&("file"===a&&"string"!=typeof r.file?i.append("file",r.file,String(r.fileName)):"tags"===a&&Array.isArray(r.tags)?i.append("tags",r.tags.join(",")):"signature"===a?i.append("signature",r.signature):"expire"===a?i.append("expire",String(r.expire)):"token"===a?i.append("token",r.token):"responseFields"===a&&Array.isArray(r.responseFields)?i.append("responseFields",r.responseFields.join(",")):"extensions"===a&&Array.isArray(r.extensions)?i.append("extensions",JSON.stringify(r.extensions)):"customMetadata"!==a||"object"!==e(r.customMetadata)||Array.isArray(r.customMetadata)||null===r.customMetadata?void 0!==r[a]&&i.append(a,String(r[a])):i.append("customMetadata",JSON.stringify(r.customMetadata)));i.append("publicKey",n.publicKey),function(e,t,r){v(e,t).then((function(e){return g(!1,e,r)}),(function(e){return g(!0,e,r)}))}(t,i,o)}else g(!0,d,o);else g(!0,c,o);else g(!0,y,o);else g(!0,p,o);else g(!0,u,o);else g(!0,s,o)},x={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig",raw:"raw"},w=["path","query"],O=function(){return"path"},P=function(e){return"query"===e.transformationPosition},j=function(e){return void 0!==e.transformationPosition&&-1!=w.indexOf(e.transformationPosition)},S=function(e){return e&&(x[e]||x[e.toLowerCase()])||""},T=function(){return":"},k=function(){return","},M=function(){return"-"};function A(e){return"string"==typeof e&&"/"==e[e.length-1]&&(e=e.substring(0,e.length-1)),e}function I(e,t){var r=t||"/",n=new RegExp(r+"{1,}","g");return e.join(r).replace(n,r)}var E=function(e){if(!e.path&&!e.src)return"";var t,r,n;try{e.path?(n=new URL(e.urlEndpoint).pathname,t=new URL(I([e.urlEndpoint.replace(n,""),e.path]))):(t=new URL(e.src),r=!0)}catch(e){return console.error(e),""}for(var o in e.queryParameters)t.searchParams.append(o,String(e.queryParameters[o]));var a=function(e){if(!Array.isArray(e))return"";for(var t=[],r=0,n=e.length;r<n;r++){var o=[];for(var a in e[r]){var i=S(a);if(i||(i=a),"-"===e[r][a])o.push(i);else if("raw"===a)o.push(e[r][a]);else{var s=e[r][a];"oi"!==i&&"di"!==i||(s=(s=A(("string"==typeof(u=s||"")&&"/"==u[0]&&(u=u.slice(1)),u))).replace(/\//g,"@@")),o.push([i,s].join(M()))}}t.push(o.join(k()))}var u;return t.join(T())}(e.transformation);return a&&a.length&&(P(e)||r?t.searchParams.append("tr",a):t.pathname=I(["tr"+T()+a,t.pathname])),t.pathname=I(n?[n,t.pathname]:[t.pathname]),t.href};return function(){function n(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),r(this,"options",{sdkVersion:"javascript-".concat("2.0.0"),publicKey:"",urlEndpoint:"",transformationPosition:O()}),this.options=o(o({},this.options),e||{}),!this.options.urlEndpoint)throw a;if(!j(this.options))throw i}var s,u,p;return s=n,(u=[{key:"url",value:function(e){return t=e,r=this.options,E(o(o({},r),t));var t,r}},{key:"upload",value:function(t,r,n){var a;if("function"==typeof r?a=r:n=r||{},!t||"object"!==e(t))return g(!0,f,a);var i=o(o({},this.options),n),s=(t||{}).xhr;delete t.xhr;var u,p,l=s||new XMLHttpRequest;return(u=this,p=b,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(t.length!==p.length||void 0===t[t.length-1])return new Promise((function(e,r){t.pop(),t.push((function(t){if(t)return r(t);for(var n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];e(o.length>1?o:o[0])})),p.call.apply(p,[u].concat(t))}));if("function"!=typeof t[t.length-1])throw new Error("Callback must be a function.");p.call.apply(p,[u].concat(t))})(l,t,i,a)}}])&&t(s.prototype,u),p&&t(s,p),n}()}));
